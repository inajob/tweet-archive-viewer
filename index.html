<html>
<head>
<meta charset="UTF-8">
<script>
window.YTD = {tweet: {}};
</script>
<script src="tweet.js"></script>
<style>
body{
  color: white;
  background-color: black;
}
div {
  font-size: xx-small;
}
div.piece{
    background-color: #333;
    margin: 3px;
    padding: 3px;  
		border: solid 2px #666;
    border-radius: 10px;
}
div.container{
  column-count:4;
	column-gap: 0;
}
a{color: #ddf;}
</style>
</head>
<body>
<h1>Tweet archive viewer 2021</h1>
<a href="?mode=ranking">ranking</a>
<a href="?mode=monthly">monthly</a>
<a href="?mode=search&q=Arduboy">search</a>


<script>
var count = 0
var tweets = [];
YTD.tweet.part0.forEach(function(t){
  var d = new Date(t.tweet.created_at);
  if(d.getFullYear() == 2021){
    tweets.push(t);
  }
  count ++;
});

var search = document.location.search;
var opts = {};
if(search.length > 0){
  search = search.replace("?","")
  search.split("&").forEach((p) => {
    let parts = p.split("=")
    opts[parts[0]] = parts[1]
  })
}
mode = opts['mode']

document.write("<h1>" + mode + "</h1>")

function searchFunc(){
	document.write("<div class='container'>")
  YTD.tweet.part0.forEach(function(t){
    let q = decodeURIComponent(opts['q'])
    if(t.tweet.full_text.indexOf(q) != -1){
				document.write("<div class='piece'>")
		    document.write("<div>"+ t.tweet.created_at + t.tweet.full_text + "<a href='https://twitter.com/aaa/status/" +t.tweet.id+ "'>*</a>"+ "</div>");
				if(t.tweet.entities.media){
						t.tweet.entities.media.forEach(function(e){
								document.write('<img src="'+ e.media_url +':thumb">');
							});
					}
				document.write("</div>")
    }
  });
	document.write("</div>")
}

function monthly(){
  // monthly
  tweets.sort(function(a, b){return (new Date(a.created_at)) - (new Date(b.created_at))});

  var preMonth = -1;
  tweets.forEach(function(t){
    var d = new Date(t.tweet.created_at);
    if(preMonth != d.getMonth()){
      document.write("<h1>" + (d.getMonth() + 1) + "</h1>");
    }
    preMonth = d.getMonth();
    var ds = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes();
    document.write("<div>" + ds + ":" + t.tweet.full_text + "</div>");
    if(t.tweet.entities.media){
      t.tweet.entities.media.forEach(function(e){
        document.write('<img src="'+ e.media_url +':thumb">');
      });
    }
  })
}

function rt(){
  // RT ranking

  tweets.sort(function(a, b){return parseInt(b.tweet.retweet_count) - parseInt(a.tweet.retweet_count)});
  tweets.forEach(function(t){
    var d = new Date(t.tweet.created_at);
    var ds = d.getFullYear() + "/" + (d.getMonth() + 1) + "/" + d.getDate() + " " + d.getHours() + ":" + d.getMinutes();
    document.write("<div>" + "RT: " + t.tweet.retweet_count + " "  + "fav: " + t.tweet.favorite_count + " https://twitter.com/ina_ani/status/" + t.tweet.id_str + " " + ds + ":" + t.tweet.full_text + "</div>");
    if(t.tweet.entities.media){
      t.tweet.entities.media.forEach(function(e){
        document.write('<img src="'+ e.media_url +':thumb">');
      });
    }
  })
}

switch(mode){
  case "monthly":
    monthly()
    break
  case "ranking":
    rt()
    break
  case "search":
    searchFunc()
    break

}

</script>

</body>
</html>
